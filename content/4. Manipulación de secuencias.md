Temas a abordar:
- Manipulación de archivos procedentes de `raw data` (`fasta`, `fastq`) o de ensamblajes con `Seqkit`.
- Obtención de información taxonomica con `Taxonkit`

#### seqkit
[Repositorio](https://github.com/shenwei356/seqkit) || [Documentación](https://bioinf.shenwei.me/seqkit/usage/)

Seqkit permite la manipulación y procesamiento de archivos FASTQ y FASTA de manera eficiente.

Se puede instalar vía conda y verificar su versión y ayuda.
```bash
conda install -c bioconda seqkit
```

- Convertir archivo fastq a formato fasta
```bash
seqkit fq2fa sequences.fq -o sequences.fa
```

- Convertir un archivo fastq multilínea a formato fastq de 4 líneas
```bash
seqkit seq reads_1.fq.gz -w 0
```

- Obtener el reverso complementario
 ```bash
 seqkit seq hairpin.fa.gz --reverse --complement
```

- Eliminar gaps dentro de las secuencias
```bash
seqkit seq --remove-gaps
```

- Filtrar secuencias por tamaño
```bash
seqkit seq sequences.fa --min-len 100 --max-len 1000
seqkit seq sequences.fa --min-len 100 --max-len 1000
```

- Obtener estadísticas básicas de las secuencias (cantidad de secuencias, tamaño mínimo y máximo, promedio de longitud, etc). Se pueden obtener las estadisticas de varios archivos a la vez.
```bash
seqkit stats sequences.fa
seqkit stats *.f{a,q}.gz
```

- Obtener un histograma de los tamaños de las secuencias o calidad promedio
```bash
seqkit watch --fields ReadLen sequences.fq.gz -O histogram_len.png
seqkit watch --fields MeanQual sequences.fq.gz -O histogram_quality.png

```
	- Campos disponibles para realizar el histograma: ReadLen, MeanQual, GC, GCSkew.

- Traducir secuencias a proteina
```bash
seqkit translate c.fna
```

- Imprimir el nombre de las secuencias, o su identificador solamente
```bash
seqkit seq hairpin.fa.gz --name
seqkit seq hairpin.fa.gz --name --only-id
```

- Convertir RNA a DNA
```bash
seqkit seq sequences.fa --rna2dna
```

- Filtrar secuencias por id
```
 seqkit grep -p "d9321e7b-3969-4ecd-9bb5-e85d4c59d86f" sequences.fa
 seqkit grep -f ids_to_filter.txt sequences.fa
```
	Se puede utilizar la opción `-v` para realizar la búsqueda inversa, es decir, seleccionar todas aquellas lecturas que no esten en la lista indicada.

#### taxonkit
[Repositorio](https://github.com/shenwei356/taxonkit) || [Documentación](https://bioinf.shenwei.me/taxonkit)

`TaxonKit` es un conjunto de herramientas que permiten la manipulación de datos de taxonomía provenientes de NCBI.

Para utilizarlo se debe tener descargado el archivo de taxonomías de NCBI [taxdb](ftp://ftp.ncbi.nih.gov/pub/taxonomy/taxdump.tar.gz), los cuales deben estar en el directorio `$HOME/.taxonkit`. En caso contrario, se puede indicar mediante la línea de comando el directorio que posee los archivos de taxonomía (parámetro `--data-dir`).

Se puede integrar la herramienta `csvtk` durante la ejecución de `taxonkit`. `Csvtk` permite la manipulación de archivos o información en formato `csv` y `tsv`, a través de terminal. Al utilizarlo en conjunto con `taxonkit` permite la visualización de información taxonómica de manera mucho más clara y legible por el usuario. Se puede instalar vía conda: 

```bash
conda install -c bioconda taxonkit
conda install -c bioconda csvtk
```

`Taxonkit` contiene diferentes subcomandos que permiten indicar cuál es la acción que se quiere realizar. Algunos de los más relevantes se presentan a continuación:
 - `lineage`: Dado un `taxid` imprime su linaje completo. Se le puede pasar un archivo que contenga cada `taxid` en una línea, o se puede utilizar el comando `echo` para imprimir en el terminal el `taxid` y pasárselo al comando.
 
 ```bash
taxonkit lineage taxids.txt
echo 578657 | taxonkit lineage --data-dir path_to_taxdump/

## Ambos comandos generarán el mismo formato de output: 

##output
578657	cellular organisms;Eukaryota;Opisthokonta;Metazoa;Eumetazoa;Bilateria;Protostomia;Ecdysozoa;Panarthropoda;Arthropoda;Mandibulata;Pancrustacea;Crustacea;Multicrustacea;Malacostraca;Eumalacostraca;Eucarida;Decapoda;Pleocyemata;Brachyura;Eubrachyura;Heterotremata;Leucosioidea;Hymenosomatidae;Halicarcinus;Halicarcinus planatus
 ```
Esta información es el símil a una búsqueda en [NCBI](https://www.ncbi.nlm.nih.gov), ajustando las opciones para buscar información taxonómica. ([Halicarcinus planatus taxonomy NCBI](https://www.ncbi.nlm.nih.gov/Taxonomy/Browser/wwwtax.cgi?id=578657&lvl=0)).

Se puede utilizar la herramienta `csvtk` para manipular la salida en el comando anterior y hacerla más leíble para el usuario. El subcomando `cut` permite eliminar información, la opción `-H` indica que no se posee un header mientras que la opción -`t` indica que la información está separada por tabuladores, la opción `-f` indica que solo se seleccione la columna 3. Las opciones `-H` y `-t` son compartidas por todos los subcomandos, la opción `-f`  del subcomando `unfold`, permite expandir alguna columna, y convertir cada elemento en una fila en base al separador indicado con la opción `-s`. 

 ```bash
 echo 2697049 \
    | taxonkit lineage --data-dir path_to_taxdump/ -t \
    | csvtk cut -Ht -f 3 \
    | csvtk unfold -Ht -f 1 -s ";" \
    | taxonkit lineage -r -n -L --data-dir path_to_taxdump/ \
    | csvtk cut -Ht -f 1,3,2 \
    | csvtk pretty -H -t

## output
10239     superkingdom   Viruses
2559587   clade          Riboviria
2732396   kingdom        Orthornavirae
2732408   phylum         Pisuviricota
2732506   class          Pisoniviricetes
76804     order          Nidovirales
2499399   suborder       Cornidovirineae
11118     family         Coronaviridae
2501931   subfamily      Orthocoronavirinae
694002    genus          Betacoronavirus
2509511   subgenus       Sarbecovirus
694009    species        Severe acute respiratory syndrome-related coronavirus
2697049   no rank        Severe acute respiratory syndrome coronavirus 2
 ```
 - `reformat`: 
```bash
taxonkit lineage taxid.txt | awk '$2!=""' > lineage.txt

 cat lineage.txt \
  | taxonkit reformat -F \
  | csvtk -H -t cut -f 1,3 \
  | csvtk -H -t sep -f 2 -s ';' -R \
  | csvtk add-header -t -n taxid,kindom,phylum,class,order,family,genus,species \
  | csvtk pretty -t


## outtaxid    kingdom     phylum            class              order                family            genus          species

578657   Eukaryota   Arthropoda        Malacostraca       Decapoda             Hymenosomatidae   Halicarcinus   Halicarcinus planatus
```

 - `name2taxid`: Retorna el `taxid` para un nombre científico dado.
 Se le puede indicar un solo nombre científico o se le puede pasar un archivo donde cada línea contenga un nombre científico.
 
 ```bash
 >  echo  Halicarcinus Planatus | taxonkit name2taxid
 Halicarcinus Planatus	578657

 > taxonkit name2taxid scientifics_names.txt
 Halicarcinus Planatus	578657
 Amanita Muscaria	41956
 Homo Sapiens	9606

 ```
 
 También se puede mezclar los comandos presentados anteriormente `name2taxid` con `lineage` para que a partir de un nombre científico obtengamos su linaje completo y Se puede utilizar `csvtk` para eliminar columnas que no interesan y formatear con tabuladores.
 ```bash
 
taxonkit name2taxid scientifics_names.txt | taxonkit lineage --taxid-field 2

taxonkit name2taxid scientifics_names.txt | taxonkit lineage -i 2 -r \                                            
 | taxonkit reformat -i 1 \
 | csvtk cut -H -t -f 1,2,4,5 \
 | csvtk pretty -H -t

 ```
 - `filter`: Dado un rango taxonómico, filtra `taxids`
 
 - `lca`: Dado un conjunto de `taxid`, se calculará el Ancestro común más cercano (`lca`).
 En el ejemplo subsiguiente se calculará el ancestro común para los siguientes tres organismos: 
 ```bash
taxonkit lineage taxids.txt --data-dir Documentos/taxdump -L -n

### output
239934	Akkermansia
239935	Akkermansia muciniphila
349741	Akkermansia muciniphila ATCC BAA-835

```

Los tres organismos pertenecientes al género `Akkermansia`, por lo cual se obtuvo como resultado que el ancestro común más cercano entre ellos es aquel con el `taxid` 239934, es decir, el género `Akkermansia`. 
 ```bash
 > echo 239934, 239935, 349741 | taxonkit lca -s ", "
 
 ## output:
 239934, 239935, 349741 239934
 ```

En el siguiente ejemplo se calcula el ancestro común más cercano entre los organismos utilizados anteriormente, y el humano, y se indica que el ancestro común más cercano es aquel que posee el `taxid` 131567 (Organismo celular).

 ```bash
 > echo 39934 239935 349741 9606 | taxonkit lca
 
 ## output:
39934 239935 349741 9606	131567
 ```