Temas a abordar:
- Uso de línea de comando
- Ambiente de trabajo con conda
- Formato de archivos

## Uso de línea de comando

La línea de comandos o `cli`, es una interfaz basada en texto que permite la ejecución de los comandos que se escribe en ella. El uso de programas en línea de comandos tiene múltiples ventajas, principalmente facilitar la integración con otras herramientas y la ejecución en ambientes que no suelen contar con interfaz gráfica (cloud / HPC). La mayoría de las herramientas bioinformáticas funcionan primaria o únicamente a través de línea de comandos.

Un comando es un programa que al ejecutarlo en la interfaz de línea de comando realiza una acción determinada. Al ejecutar un comando, el sistema operativo ejecuta un proceso donde en la mayoría de los casos se lee una entrada, se realiza algún procesamiento a los datos y se genera un resultado (output).

En general, un comando tiene la sintaxis
```bash
comando [subcomando] [opciones] <argumentos>
```

Los `<argumentos>` generalmente son los archivos de entrada y salida para el comando, y son requeridos. Las opciones, en cambio, sirven para modificar el comportamiento del comando y pueden ser opcionales o no, generalmente se indican en la forma `--opcion` (forma larga) o `-o` (forma corta) y pueden o no llevar un argumento asociado. Dependiendo la herramienta, puede existir `[subcomando]`.

Por ejemplo, en el comando
```bash
samtools view seq.sam --output seq.bam --bam --threads 4
```
- `samtools`: Comando (herramienta). 
- `view`: Subcomando, esta herramienta posee varios que cumplen varias funciones.
- `seq.sam`: Argumento.
- `--output seq.bam`: Opción `--output` que tiene el argumento `seq.bam`. Esta herramienta igual soporta indicar `-o` en lugar de `--output`.
- `--bam`: Opción sin argumentos.
- `--threads 4`: Opción con el argumento `4`.

Generalmente, no importa el orden en que se especifiquen los argumentos y las opciones, por lo que en nuestro ejemplo podríamos indicar los 4 elementos posteriores al subcomando en cualquier orden y el resultado sería el mismo. Sin embargo, existen herramientas que requieren indicar las opciones antes de los argumentos, por ejemplo.

La mayoría de los comandos proveen una ayuda en la que detallan sus opciones y argumentos. Si bien no es un requisito, la convención es utilizar `-h`, o `--help` para acceder a la ayuda.

Al indicar directorios a comandos se pueden utilizar algunos atajos: 
- `.` (punto): directorio actual.
- `..`: directorio padre.
- `~`: "home" (directorio base de usuario).
- `*`: Indicar que se quiere realizar la operación sobre todos los archivos. Se puede combinar con otros patrones. 

### Comandos comunes

#### Acceso remoto a servidor(`ssh`)
Secure Shell (`SSH`) es un protocolo para la administración remota que permite que los usuarios puedan conectarse y utilizar servidores remotos a través de internet. Las conexiones a través de `ssh` son cifradas, por lo que es seguro el envío de contraseñas, la edición de archivos y almacenamiento de información.

Para conectarnos a un servidor remoto utilizamos el comando `ssh` indicando el usuario y el servidor al que se quiere realizar la conexión
```bash
ssh <user>@<host>

ssh jaldridge@10.34.1.15
ssh dalvarez@10.9.0.163
```

Para iniciar sesión a través de SSH en Windows se debe abrir la consola de Windows (`cmd`) y ejecutar el comando `shh` con el nombre de usuario y servidor al que se quiere acceder.

Al momento de iniciar sesión se requerirá la contraseña del servidor. Cabe destacar, al momento de escribir la contraseña, no se visualizarán los típicos  `*`, la contraseña se escribirá en modo 'oculto'
Una vez autenticada la cuenta en el servidor, el usuario podrá visualizar una sesión posicionada en su `home`.
![[ssh.webm]]

#### Moverse entre directorios (`cd`)
El comando `cd` permite moverse entre directorios, a continuación del comando se debe indicar el directorio destino.
conda activate alignamen
```bash
cd ..                 # Mueve la ubicación de la sesion al directorio padre 
cd                    # Mueve al home
cd secuencias         # Ingresa al directorio secuncias
cd secuencias/fasta   # Ingrsa al directorio fasta (que se encuentra dentro del directorio secuencias)
```

![[cd_1.webm]]

También se puede utilizar el símbolo `..` para moverse al directorio padre. En caso de que el comando `cd` no tenga un directorio destino, se moverá directamente al `home` del usuario.

![[cd_2.webm]]

#### Listar contenido de un directorio (`ls`)
El comando `ls` lista los archivos y directorios de un directorio. El comando `ls` cuenta con varios parámetros que se pueden añadir al ejecutar el comando, los cuales permitirán modificar la forma de visualizar el listado de archivos. El parámetro `-l` permite visualizar información, detalla de los archivos (permisos, fecha de modificación, tamaño, etc.), mientras el parámetro `-h` permite visualizar el tamaño del archivo en formato leíble (Kb, Mb, Gb, Tb). El parámetro `-a`/`-all` permite visualizar archivos ocultos dentro del directorio.
```bash
ls 
ls secuencias
ls -lh
```

En caso de que ejecutar el comando `ls` sin parámetros, se listará el nombre de los archivos sin ningún detalle extra.

![[ls.webm]]

#### Copiar archivos (`cp`)
El comando `cp` permite copiar archivos entre directorios. Se puede usar la opción `-r` para copiar directorios de manera recursiva. Cabe destacar que en caso de existir un archivo con el mismo nombre en el directorio, este se sobrescribirá.
```bash
cp sequences.fasta sequences # Copiamos el archivo sequences.fasta al directorio secuences
cp -r sequences data # Copiamos el directorio secuences y todo su contenido en la carpeta data
cp sequences.fasta . # Copia el archivo sequences.fasta al direcotrio actyal
cp *.fasta sequences # Copia todos los archivos que finalicen en .fasta al directorio sequences
```

![[cp_1.webm]]

Se puede copiar de a un archivo o directorio a la vez, o también se puede copiar varios archivos al mismo tiempo que tengan algún patrón determinado en el nombre. Un símbolo útil a utilizar en estos casos es el `*`. En el ejemplo a continuación, la expresión `*.fastq.xz` nos permite seleccionar todos los archivos que finalicen con `.fastq.xz`, sin importar los caracteres que haya antes.

![[cp_2.webm]]

#### Mover archivos (`mv`)
El comando `mv` permite mover archivos entre directorios. Funciona de igual forma que el comando `cp`. 
```bash
mv sequences.fasta sequences # Mueve el archivo sequences.fasta al directorio secuences
mv sequences data # Mueve el directorio secuences y todo su contenido en la carpeta data
mv sequences.fasta . # Mueve el archivo sequences.fasta al direcotrio actyal
mv *.fasta sequences # Mueve todas los archivos que finalicen en .fasta al directorio sequences
```

Al igual que el comando `cp`, el comando `mv` permite copiar de a un archivo a la vez o de múltiples archivos o directorios siguiendo un patrón en común.

![[mv_1.webm]]

#### Renombrar archivos (`mv`)
También se puede utilizar el comando `mv` para renombrar archivos, para esto, se debe indicar el nombre del archivo original y el nuevo nombre del archivo.
```bash
mv secuences.fasta sequences.fasta 
```

![[mv_2.webm]]

#### Crear directorios (`mkdir`)
El comando `mkdir`permite crear nuevos directorios.
```bash
mkdir analyses # Crear el directorio analyses en el directorio actual
mkdir data/analyses # Crea el directorio analyses dentro del directorio data
```

![[mkdir.webm]]


#### Directorio actual (`pwd`)
El comando `pwd` imprime el directorio de trabajo actual.
```bash
pwd 
```

![[pwd.webm]]

#### Eliminar archivos (`rm`)
El comando `rm` se utiliza para eliminar archivos y directorios. Este comando debe utilizarse con cuidado, ya que a la hora de ejecutarse elimina los archivos sin pedir una confirmación previa.

![[rm.webm]]

El comando `rm -r` para eliminar directorios de forma recursiva, pero se debe tener cuidado, ya que se va a borrar toda la información dentro del directorio.

#### Visualización de archivos (`less`, `cat`, `head`, `tail`)
- `cat`:  Imprime el archivo completo a visualizar en la consola.
- `head`: Imprime las primeras 10 líneas del archivo a visualizar en la consola.
- `tail`: Imprime las últimas 10 líneas del archivo a visualizar en la consola.
Para los comandos `head` y `tail` se puede utilizar el parámetro `-n` para indicar la cantidad de líneas a imprimir.
- `less`: Permite visualizar archivos de a una página a la vez. Para movernos dentro del archivo se utilizan los siguientes shortcuts
	- `N`: Moverse a la página anterior.
	- `n`: Moverse a la página siguiente.
	- `q`: Salir de la visualización.
	- `/[string]`: Buscar alguna palabra dentro del archivo en dirección hacia adelante del archivo.
	- `?[string]`: Buscar alguna palabra dentro del archivo en dirección hacia atrás del archivo.

![[less.webm]]

#### Filtrado de líneas (`grep`)
En algunas ocasiones es útil filtrar las líneas de un archivo para visualizar información contenida en las líneas filtradas o para contar la cantidad de ocurrencias.

En el siguiente ejemplo podemos realizar un filtro y obtener solo aquellas filas que contienen la palabra `chrx`.
```bash
grep "chrX" multisample_anno_filtered.anno.vcf.csv
```


#### Edición de archivos (`micro`)
Para editar archivos a través de la terminal existen múltiples alternativas tales como `nano`, `vim`, `micro`, y otros más. Para este curso se utilizará la herramienta `micro`, la cual es bastante fácil de utilizar, ya que utiliza combinaciones de teclas comunes a herramientas de escritorio, además de soportar el posicionamiento del curso y selección utilizando el mouse.

Para editar un archivo se debe utilizar el comando `micro` e indicar el archivo a editar. En caso de que el archivo no exista, se creará un archivo nuevo y vacío.
```bash
micro file.txt
```

![[micro.webm]]
El uso de `micro` se basa en el uso del mouse y combinaciones de teclas para realizar operaciones en el archivo. A continuación se listan los más relevantes:
	- `Ctrl`+ `q`: Salir del editor.
	- `Ctrl`+ `c`: Copiar el texto seleccionado. 
	- `Ctrl`+ `p`: Pegar el texto del portapapeles
	- `Ctrl`+ `z`: Deshacer la última edición
	- `Ctrl`+ `y`: Rehacer la última edición. 
	- `Ctrl`+ `s`: Guardar los cambios. 

Se pueden encontrar todos las combinaciones de teclas en la [Documentación oficial](https://github.com/zyedidia/micro/blob/master/runtime/help/defaultkeys.md) de micro.


### Otros elementos

#### Pipe (`|`)
El operador `|` permite enviar la salida de un comando a otro, permitiendo procesar secuencialmente varios comandos a la vez sin tener que ir guardando la salida ni generando archivos intermedios.

El siguiente ejemplo se utilizará la salida del comando `grep` para contar las líneas con el comando  `wc -l` es decir, se imprimirá en pantalla la cantidad de líneas que contienen la palabra `chrX`.
```bash
grep "chrX" multisample_anno_filtered.anno.vcf.csv | wc -l
```

#### Redirección de salida (`>`)
Se puede utilizar el símbolo `>` para guardar en un archivo la salida de un comando. Esto es muy útil cuando se ejecutan programas que entregan un registro o información relevante de la ejecución del programa.

El siguiente ejemplo almacenará en el archivo `chrX_variants.vcf` solamente aquellas variantes que se encuentran en el `chrX`.
```bash
grep "chrX" multisample_anno_filtered.anno.vcf.csv > chrX_variants.vcf
```

Es relevante considerar que si el archivo existe, su contenido será reemplazado al usar `>`. En caso de que el archivo exista y se quiera añadir la salida del comando al final del archivo, se puede utilizar `>>`.

#### Comandos multilínea(`\`)
En caso de utilizar comandos muy largos o que presenten muchas opciones, se puede utilizar el operador `\` para dividir el comando en múltiples líneas. Cabe destacar que después del `\` no pueden haber espacios vacíos ni caracteres. 

A continuación se presenta un ejemplo al utilizar comandos anidados con `|` y formato multilínea.
```bash
grep "chrX" multisample_anno_filtered.anno.vcf.csv \
| wc -l
```

También se puede utilizar esta forma al utilizar un solo comando y múltiples opciones u argumentos.
```bash
guppy_basecaller \
    --input_path <directorio_fast5> \
    --save_path <directorio_output> \
    --config dna_r9.4.1_450bps_sup \
    --recursive \
    --device 'auto' \
    --num_callers 16
```


#### Reutilización de comandos previos 
- Al usar una línea de comando se puede utilizar la flecha hacia arriba ↑ para navegar entre los comandos utilizados anteriormente.
- Se puede utilizar el comando `history` para visualizar los últimos 500 comandos utilizados.
- Se puede buscar algún comando utilizado con la combinación de teclas `Ctrl+r`.

## Ambiente de trabajo

Ambiente o entorno de trabajo se refiere al sistema que se utiliza para la gestión y ejecución de herramientas. Este aspecto es sumamente relevante, ya que en general existe mucha diversidad en cuanto a cómo se deben instalar las herramientas y qué necesitan para su ejecución, por lo que la gestión puede ser bastante tediosa. Las alternativas más destacables son `conda` y los contenedores. Durante este taller se utilizará `conda` para la instalación y uso de herramientas bioinformáticas.

### Conda
Conda es un gestor de paquetes de código abierto y multiplataforma que permite la instalación de herramientas. Para ello utiliza los repositorios de [Anaconda](https://anaconda.org), en los cuales existe una gran cantidad de herramientas, librerías e incluso paquetes para Python y R.

Otra característica importante de conda es la creación de entornos virtuales, los cuales pueden poseer diferentes herramientas instaladas y/o diferentes versiones de éstas. Estos entornos son completamente independientes entre sí, y pueden ser cargados cuando deseen utilizarse. 

![[conda.png]]

#### Uso de Conda
##### Crear entornos virtuales
Para crear entornos se utiliza el subcomando `create`, con la opción `--name` (`-n`) para indicar el nombre del ambiente a crear.
```bash
conda create --name <name_env>
conda create --name bioinformatic-analyses
conda create -n bioinformatic-analyses
```

Se puede también crear entornos indicando paquetes a instalar desde su creación.
```bash
conda create -n python38 python=3.8
```

##### Listar entornos
Para visualizar los entornos virtuales existentes en el equipo se pueden utilizar los siguientes comandos:
```bash
conda env list
conda info --envs
```

##### Activar entorno
Al activar un entorno virtual, se podrán ejecutar las herramientas instaladas en este y se podrán instalar/desinstalar herramientas. El entorno se mantendrá activado mientras la terminal siga activa. Solo puede haber activado un entorno a la vez por terminal, por lo que si se desea utilizar un entorno diferente, debe desactivarse el actual o se puede activar en una terminal diferente.
```bash
conda activate <name_env>
conda activate bioinformatic-analyses
```

##### Desactivar entorno
Al desactivar un entorno, ya no será posible ejecutar las herramientas instaladas en éste.
```bash
conda deactivate 
```

##### Eliminar entornos
Se puede eliminar entornos virtuales con el subcomando remove y las opciones `-n` o `--name` para indicar el nombre del entorno a eliminar

```bash
conda env remove -n <name_env>
conda env remove -n bioinformatic-analyses
conda env remove --name bioinformatic-analyses
```

##### Instalar paquetes 
Para instalar paquetes se utiliza el subcomando `install` y a continuación el nombre del paquete a instalar. La página de Anaconda cuenta con una sección de búsqueda donde se pueden localizar los paquetes disponibles y el comando a utilizar para instalarlo ([Anaconda Search](https://anaconda.org/search)). Otra opción para buscar los paquetes es utilizar el subcomando `search`.

Existen diferentes repositorios en anaconda, los cuales son llamados "canales". En algunos casos es necesario utilizar canales adicionales al principal para instalar herramientas más específicas o versiones más nuevas de los paquetes. En particular, el canal [bioconda](https://bioconda.github.io/) se especializa en software del área bioinformática, por los que podría ser útil tenerlo activado permanentemente (instrucciones en su sitio web).

Al momento de instalar se puede indicar un canal específico con la opción `-c`.
```bash
conda install -c bioconda flye
conda install -c bioconda seqkit
```

Adicionalmente, se puede indicar la versión del paquete.
```bash
conda install -c bioconda flye=2.9.1
```

##### Listar paquetes instalados
Para listar los paquetes instalados en un ambiente se puede utilizar el subcomando `list`. Cabe destacar que el ambiente debe encontrarse activado para que el comando funcione correctamente.
```bash
conda list
```

También se puede utilizar `|` y `grep` para filtrar la lista de paquetes y visualizar solamente la información de interés.
```bash
conda list | grep samtools
```

##### Actualizar paquetes
Para actualizar paquetes se utiliza el subcomando `update` y se indica el paquete a actualizar
```bash
conda update multiqc
```

##### Eliminar paquetes
Para eliminar paquetes se utiliza el subcomando `remove` y se indica el paquete a eliminar
```bash
conda remove samtools
```

#### Recomendaciones
* Existe una implementación alternativa a conda llamada [mamba](https://github.com/mamba-org/mamba), la cual es notablemente más rápida en la instalación de paquetes. Se puede instalar directamente con conda, y posteriormente puede ser utilizado de la misma forma que se usa conda para la gestión de paquetes.
* Al instalar paquetes se recomienda verificar la versión del paquete a instalar con el repositorio oficial o sitio oficial de la herramienta, ya que en algunas ocasiones conda suele instalar versiones más antiguas en caso de que hayan restricciones de dependencias, lo cual podría llegar a perjudicar los resultados de los análisis.
* En la página oficial de conda se pueden encontrar las instrucciones de instalación para diferentes sistemas operativos ([Instrucciones de Instalación](https://conda.io/projects/conda/en/latest/user-guide/install/)).



## Formatos de archivos

### FAST5
Los archivos `fast5` almacenan las señales sin procesar de una secuenciación de Nanopore. Se almacenan en formato `HDF5` (formato de datos jerárquico).

![[MinION_GIF_01.webm]]

Existen diferentes herramientas para visualizar y analizar archivos `fast5`, pero en este taller solamente se abordará su procesamiento a archivos `fastq`.  De igual forma, es importante siempre recordar que estos archivos almacenan la señal leída por los poros, la cual es transformada a secuencia de nucleótidos posteriormente.
![[fast5_view.png]]
En caso de haber realizado el proceso de basecalling, los archivos FAST5 igualmente pueden contener metadatos asociados al proceso, así como la secuencia de nucleótidos.

Para secuenciaciones de la plataforma 454 Roche, la RAW data se almacena en formato `sff`, mientras que para Illumina en formato `BCL`. Para PacBio, la información se almacena en formato `bas.h5` o `bax.h5`.  

### FASTQ
El formato `fastq` almacena secuencias y tiene como particularidad almacenar la calidad de la secuencia con codificación `Phred`. Cada secuencia se almacena en cuatro líneas:

1. Identificador de la secuencia. Comienza siempre con `@`
2. Secuencia
3. Separador (`+`)
4. Puntajes de calidad obtenidos en el basecalling. Se representan con caracteres ASCII, los cuales representan el valor de calidad para cada nucleótido.
	La equivalencia de calidad y símbolo ASCII se puede ver en la siguiente imagen:
![[qscores.png]]

Para calcular la probabilidad de que la base sea incorrecta se utiliza la fórmula   `10^(-Q/10)`

Phread Quality Score |Probabildad de una base incorrecta | Exactitud 
------------ | ------------ | ------------
10 | 1 en 10 | 90%
20 | 1 en 100 | 99%
30 | 1 en 1000 | 99,9%
40 | 1 en 10000 | 99,99%

Un ejemplo de como se ve una secuencia en un archivo `fastq` se presenta a continuación: 
```
@ee15a423-b008-44be-a4b2-5441d11b0b94 runid=fa1d76e661ac2bbb sampleid=1 read=5087 ch=53 start_time=2019-10-18T22:14:05Z
GTTGTACTTCGTTCAATCGGTAGGTGTTTAACCGGATGGTCACGCCTACCGTGACAAAGAGATTGTCGGTGTCTTTGTGTTTC
+
:F$&$&/035881()'$0&*('-.=;685()$.%($$%%&&&)+..0,&+&%.-/+,%&()$3:0&@09BF=>CC8(78029F
```

### FASTA
En el formato `fasta` cada secuencia está compuesta de dos líneas. La primera contiene el símbolo `>` seguido del identificador de la secuencia y una descripción, donde el identificador se considera todo lo que no tenga espacios inmediatamente después del símbolo `>`. La segunda línea almacena la secuencia. Opcionalmente, la secuencia puede ser dividida en múltiples filas con ancho fijo, lo cual es bastante común cuando se trata de secuencias muy largas.
A diferencia de los archivos `fastq`, los archivos `fasta` no almacenan información de la calidad de la secuencia, por lo que suelen contener información ya procesada.

```
>tr|A0A0S4KA35|A0A0S4KA35_9BURK Nitrous-oxide reductase OS=Janthinobacterium sp. CG23_2 GN=BN2497_12073 PE=4 SV=1
MKKNSPAPSSPAIVGSRRDFLGKSALAGLATAGATIGLTGCKEEAAPGKAAVPAKAADNSDHIKPGQLDTYYAFISAGHGGEVRVLGLPSGRTLKRIPVFNMDCMVGWGITNESKAIIGTKADGSLQYNTGDTHHVHGSYKDGTYDSRWLFVNDKINARLARIRMDTMECDKITNLPNVMGFHGIFPDKRDPVDAAVNYTTRVFCGAEFHTPLPNDGRDLDDPTKWGCLFTCVDAASMEVRWQCRIDGNMELVATSYDGKLAAATQYNTEGGVDLAGMMSAERDACIFFNVARIEQAIKDGKATTIGNSKVPVVDGRKAANADPATAVTCYVPVGKNPHGVNASPDGKYFVCAGKLSPTATVIELTKVLAWFGGEVKLPRDCVVAEPELGLGPLHTAFDGKGNAF
>barcode01 MN908947.3
NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNAGATCTGTTCTCTAAACGAACTTTAAAATCTGTGTGGCTGTCACTCGGCTGCATGCTTAGTGCACTCACGCAGTATAATTAATAACTAATTACTGTCGTTGACAGGACACGAGTAACTCGTCTATCTTCTGCAGGCTGCTTACGGTTTCGTCCGTGTTGCAGCCGATCATCAGCACATCTAGGTTTTGTCCGGGTGTGACCGAAAGGTAAGATGGAGAGCCTTGTCCCTGGTTTCAACGAGAAAACACACGTCCAACTCAGTTTGCCTGTTTTACAGGTTCGCGACGTGCTCGTACGTGGCTTTGGAGACTCCGTGGAGGAGGTCTTATCAGAGGCACGTCAACATCTTAAAGATGGCACTTGTGGCTTAGTAGAAGTTGAAAAAGGCGTTTTGCCTCAACTTGAACAGCCCTATGTGTTCATCAAACGTTCGGATGCTCGAACTGCACCTCATGGTCATGTTATGGTTGAGCTGGTAGCAGAACTCGAAGGCATTCAGTACGGTCGTAGTGGTGAGACACTTGGTGTCCTTGTCCCTCATGTGGGCGAAATACCAGTGGCTTACCGCAAGGTTCTTCTTCGTAAGAACGGTAATAAAGGAGCTGGTGGCCATAGTTACGGCGCCGATCTAAAGTCATTTGACTTAGGCGACGAGCTTGGCACTGATCCTTATGAAGATTTTCAAGAAAACTGGAACACTAAACATAGCAGTGGTGTTACCCGTGAACTCATGCGTGAGCTTAACGGAGGGGCATACACTCGCTATGTCGATAACAACTTCTGTGGCCCTGATGGCTACCCTCTTGAGTGCATTAAAGACCTTCTAGCACGTGCTGGTAAAGCTTCATGCACTTTGTCCGAACAACTGGACTTTATTGACACTAAGAGGGGTGTATACTGCTGCCGTGAACATGAGCATGAAATTGCTTGGTACACGGAACGTTCTGAAAAGAGCTATGAATTGCA
```

### SAM (Sequence Alignment Map) y BAM (Binary Alignment Map)
Los formatos `SAM` y `BAM` se crearon para estandarizar la forma de guardar alineamientos.
Ambos formatos contienen la información del alineamiento, e información relevante como puntajes de calidad asociados, información de la muestra, etc. El formato `SAM` es un formato en texto plano que puede ser leído mediante un editor de texto estándar. El formato `BAM` en cambio, es una variante comprimida del formato `SAM`, que por tanto no puede ser leída directamente (pero puede ser descomprimida para acceder a su información).

Al comienzo de estos archivos se pueden encontrar líneas de encabezado (`header`) que comienzan con el símbolo `@`, seguido por un identificador y metadatos del alineamiento. A continuación se presenta un ejemplo de `header` donde se puede visualizar la referencia utilizada y su tamaño en pares de base en la primera línea (`NC_045512.2` y `29903`), y en la segunda línea de encabezado se puede visualizar información de la herramienta utilizada para alinear y su versión, junto con el comando utilizado `minimap2`, `VN:2.24-r1122`, y `minimap2 -ax map-ont ../NC_045512_2.fasta ../201190260.fastq.gz`.
```
@SQ     SN:NC_045512.2  LN:29903
@PG     ID:minimap2     PN:minimap2     VN:2.24-r1122   CL:minimap2 -ax map-ont ../NC_045512_2.fasta ../201190260.fastq.gz
```

Luego del encabezado vienen los registros, los cuales se presentan uno por línea y están compuestos de 11 campos que representan la información propia de cada read y cómo se alineó contra la referencia.

Columna | Campo | Tipo de | Descripción 
------------ | ------------ | ------------ | ------------
1 | QNAME | Cadena de caracteres | Nombre query
2 | FLAG| Entero               | Bitwise flag
3 | RNAME | Cadena de caracteres | Nombre referencia
4 | POS | Entero               | Posición comparada
5 | MAPQ | Entero               | Calidad de mapeo
6 | CIGAR | Cadena de caracteres | Codificación de información de alineamiento
7 | **RNEXT** | Cadena de caracteres | Nombre de la referencia (igual a la columna 3, excepto para lecturas pair end mate )
8 | **PNEXT**  | Entero               | Posición de la referencia donde comienza el alineamiento
9 | TLEN | Entero               | Longitud plantilla 
10 | SEQ | Cadena de caracteres | Segmento (secuencia)
11 | QUAL | Cadena de caracteres | Calidad del segmento

El `bitwise flag` es un número decimal que representa el alineamiento en base a valores binarios (0 y 1 / Falso y Verdadero), se utiliza muchas veces para identificar la dirección de lecturas paired-end, ya que estas poseen el mismo `QNAME`. A continuación se presenta el significado de cada valor `bitwise`.

![[bitwise.png]]

El CIGAR (Concise Idiosyncratic Gapped Alignment Report) es una forma de codificación del alineamiento, que se basa en describir el alineamiento a través de operaciones utilizando números y operadores. Los operadores pueden ser los siguientes:
* M: Match, es decir, una coincidencia entre las dos secuencias a comparar
* D: Eliminación, es decir, un gap en la secuencia de referencia.
* I: Inserción, gap en la secuencia consulta.
* S: Segmento de la secuencia de consulta no aparece en el alineamiento (Soft clipping)
* H: Segmento de la secuencia de consulta no aparece en el alineamiento (Hard clipping). 
* =: Match en la columna de alineamiento
* X: Mismatch en la columna de alineamiento

A continuación se presenta un ejemplo de un alineamiento en formato `SAM`: 
```
@SQ     SN:NC_045512.2  LN:29903
@PG     ID:minimap2     PN:minimap2     VN:2.24-r1122   CL:minimap2 -ax map-ont ../NC_045512_2.fasta ../201190260.fastq.gz
d1c474cc-853e-4402-8a29-c9dcdf344fc7    16      NC_045512.2     10076   60      143S112M1D2M1D18M1D9M4I241M65S    *       0       0       TATTACGTAATAAGAAGGTTAAATATCTGAACGTGGTACACCTGTACAGCACCCGGGTTGGCTTAGCTTGTGGGTTTGACTTTAACCTTGTGGCTATGAAGCTTAAGCGTGTTGACTGGACTATTGCAAACTTACTGTACTGGTTCCCATCTGGTAAAGTTGAGGGTTGTATGGCACAAGTAATTTGTGGTACAACTACACTTAACGGTCTTTGGCTTTATGACGTAGTTTACTGTCCAAGACATGTGATCTGCACTTGAAGACATGTTTAACCCCACTATGAACATCGATTTACTCATTCGTAAGTCTAATCATAATTTCTTGGTACAGGCTGGTAATGTTCAACCTAGGGTTATTGGACATTCTATGCAAAATTGTGTACTTTTGCTTAAGGTTGATACAGCTAATCCTAAGACACCTAAGTATAAGTTTGTTCGCATTCAACCAGGACAGACTTTTTCAGTGTTAGCTTGTTATAATGGTTCACCATCTGGTGTTTACCAATGTGCTATGAGGCCCAATTTCACTAGGTGTTGTACAGGTGTACCACGTTCCAGATGTTAACAGCAATACGTAACTGAACGAAGTATTACC        $%,..-($$$$$$&&&&%$&$%&&*+''4668;9300//)(('%%%%&,,(&'(,--.0-/-3-,+((&(+*-)'')-,+)/1,**((,-.////56=-,+,8843336;:@978/'(689<>877/,+***/...9,++,874...0222..-,)&%',8;;:<<3.)((&&((46*((&,*)++-()**;::989;62....336774//,+*++/155:767344243333986665677<;;<443-.81002:;;:<<6//')21,*)''(&%'&%$$$$$&)06796778>:6668=>;;<<?@?>@==>9=;;6633<=>;5555;;3111/1100)'((*4468??<;::@>;:88:>>>ADEA65.*)-./,'&&'++234.../3=-/42---.;;1000:9:9888875555?==;;;;543337;:<<<::-*()56744466?B=;<<=?=854210-,))++555??@;998;=?=><<>@A><;;<:676899==9665578=ABB@9755759*)(')*+/08:::<::7788>7768;69;>@=<;:<<<@>8889>3333A<007.+''''))()  NM:i:19 ms:i:665        AS:i:662        nn
:i:0    tp:A:P  cm:i:40 s1:i:287        s2:i:0  de:f:0.0415     rl:i:0
```

Como se mencionó anteriormente, el formato `BAM` corresponde al formato `SAM` comprimido, por lo tanto, posee la misma información y columnas que el formato mencionado anteriormente. Tiene como ventaja, que al ser un formato comprimido, los archivos son de mucho menor tamaño y la lectura puede ser más eficiente. Muchas herramientas requieren utilizar archivos en formato `BAM` por las ventajas mencionadas anteriormente.

### PAF
El formato `PAF` describe las posiciones de mapeo aproximadas entre dos conjuntos de secuencias. Es un archivo TSV (delimitado por tabuladores) y consta de las siguientes columnas:

Columna | Tipo de | Descripción 
------------ | ------------ | ------------
1 | Cadena de caracteres | Nombre query
2 | Entero               | Tamaño de la query
3 | Entero               | Comienzo de la query
4 | Entero               | Fin de la query
5 | Cadena de caracteres | Hebra (+ o -)
6 | Cadena de caracteres | Nombre secuencia target
7 | Entero               | Tamaño secuencia target
8 | Entero               | Coordenada de inicio en hebra original
9 | Entero               | Coordenada final en la hebra original
10 | Entero              | Cantidad de secuencias que coinciden
11 | Entero              | Tamaño del bloque de alineamieno
12 | Entero              | Calidad del mapeo

### VCF (Variant Call Format)
El formato VCF almacena variantes obtenidas al comparar un conjunto de lecturas contra un genoma de referencia. Se obtiene generalmente a partir de archivos `BAM` producidos mediante mapeos.

Los archivos `VCF` poseen tres secciones:
- Sección de metadata: Todas aquellas filas que comienzan con `##`, se ubican al comienzo del archivo y generalmente poseen información de la versión del formato `VCF` utilizado, fecha, información del software utilizado y de la referencia. También contiene la descripción de los campos de la columna `INFO` y `FORMAT`.
- Cabecera del archivo (`header`)
- Listado de variantes

 El listado de variantes contiene las siguientes columnas:

Columna | Nombre | Descripción 
------------ | ------------ | ------------
1 | Chrom | Nombre secuencia en la referencia
2 | POS   | Posición
3 | ID    | Id de la variante, puede ser una variante sin identificar o de alguna bd como dbSNP
4 | REF   | Secuencia en la referencia
5 | ALT   | Secuencia alternativa
6 | QUAL  | Calidad (en base a los alelos)
7 | FILTER | Bandera para indicar si la variante pasa los filtros (PASS / FAIL)
8 | INFO   | Diferentes descripciones de la variante
9 | FORMAT | Información de la variante
10 | SAMPLES | Información de cada muestra de los campos declarados en `FORMAT` 

El campo `INFO` contiene información en formato `key=value`.

El campo `FORMAT` puede contener diferentes valores, algunos de los más usados son los siguientes:
- GT (`Genotype`): Representa el genotipo, en el caso de organismos diploides el genotipo indica ambos allelos:
	- 0/0: La muestra es homocigota respecto a la referencia.
	- 0/1: La muestra es heterocigota, portando una copia de cada uno de los alelos REF y ALT.
	- 1/1: La muestra es homocigota respecto al valor alternativo.
- AD (`Allele depth`): Profundidad del alelo sin filtrar, es decir, número de lecturas que respaldan cada alelo reportado.
- DP (`Depth coverage`): Profundidad filtrada, es decir, cantidad de lecturas que pasaron los filtros que respaldan el alelo informado.
- PL: Valor de probabilidad normalizada de los genotipos asignados, donde 0 es asignado al genotipo más probable.
- CQ (`Genotype Quality`): Valor de confianza basado en la escala `phred` para indicar que el genotipo asignado es correcto. Este valor tiene una cota máxima de 99.

A continuación se presenta un ejemplo para describir la sección `FORMAT`:
```
20  10001019    .   T   G   364.77  .   [CLIPPED]   GT:AD:DP:GQ:PL  0/1:18,15:33:99:393,0,480
```

En el ejemplo anterior:
- El genotipo es 0/1 lo que indica que es heterocigoto.
- La profundidad de aquellas lecturas que informan el valor de la referencia es 18, mientras aquellas que informan el valor alternativo son 15 lecturas.
- La profundidad filtrada es de 33.
- La calidad del genotipo es 99, el cual es el valor máximo.
- El valor phred de la probabilidad asociada a los genotipos 0/0, 0/1 y 1/1 es 393, 0 y 480, respectivamente. Esto indica que el genotipo 0/0 es el más probable con una gran diferencia (razón por la que del CQ es 99).

Dependiendo de la herramienta utilizada y el tipo de variant calling (germinal o somático), los campos informados tanto en INFO como en SAMPLES pueden variar, por lo que es recomendable leer la documentación de las herramientas para su correcta interpretación.